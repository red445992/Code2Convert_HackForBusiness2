
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShopTracker API Test Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .api-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .section-title {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102,126,234,0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ff9800 0%, #e68900 100%);
        }

        .response-area {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }

        .response-success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .response-error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stats-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .loading {
            display: none;
            color: #666;
            font-style: italic;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .product-card {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .product-card.common {
            border-color: #28a745;
            background: #d4edda;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .inventory-card {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
        }

        .inventory-card.low-stock {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .status-indicator {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-ok {
            background: #d4edda;
            color: #155724;
        }

        .status-low {
            background: #fff3cd;
            color: #856404;
        }

        .status-out {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè™ ShopTracker API Tester</h1>
            <p>Test your inventory management APIs</p>
        </div>

        <!-- API Health Check -->
        <div class="api-section">
            <h3 class="section-title">üîç API Health Check</h3>
            <button class="btn" onclick="checkHealth()">Check API Status</button>
            <div id="health-response" class="response-area"></div>
        </div>

        <!-- Get Products -->
        <div class="api-section">
            <h3 class="section-title">üì¶ Products Catalog</h3>
            <div class="form-group">
                <label>Filter by Category:</label>
                <select id="product-category">
                    <option value="">All Categories</option>
                    <option value="Beverages">Beverages</option>
                    <option value="Noodles">Noodles</option>
                    <option value="Snacks">Snacks</option>
                    <option value="Household">Household</option>
                    <option value="Personal Care">Personal Care</option>
                </select>
            </div>
            <div class="form-group">
                <label>Search Products:</label>
                <input type="text" id="product-search" placeholder="Search by name or brand...">
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="common-only" style="width: auto; margin-right: 10px;">
                    Show only common products
                </label>
            </div>
            <button class="btn" onclick="getProducts()">Get Products</button>
            <div id="products-loading" class="loading">Loading products...</div>
            <div id="products-response" class="response-area"></div>
            <div id="products-grid" class="product-grid"></div>
        </div>

        <!-- Shop Stats -->
        <div class="api-section">
            <h3 class="section-title">üìä Shop Statistics</h3>
            <div class="form-group">
                <label>Shop ID:</label>
                <input type="text" id="stats-shop-id" placeholder="Enter shop ID (use demo shop ID from console)">
            </div>
            <button class="btn" onclick="getShopStats()">Get Shop Stats</button>
            <div id="stats-loading" class="loading">Loading stats...</div>
            <div id="stats-response" class="response-area"></div>
            <div id="stats-cards" class="grid"></div>
        </div>

        <!-- Inventory -->
        <div class="api-section">
            <h3 class="section-title">üìã Current Inventory</h3>
            <div class="form-group">
                <label>Shop ID:</label>
                <input type="text" id="inventory-shop-id" placeholder="Enter shop ID">
            </div>
            <button class="btn" onclick="getInventory()">Get Inventory</button>
            <div id="inventory-loading" class="loading">Loading inventory...</div>
            <div id="inventory-response" class="response-area"></div>
            <div id="inventory-grid" class="inventory-grid"></div>
        </div>

        <!-- Record Sale -->
        <div class="api-section">
            <h3 class="section-title">üí∞ Record Sale</h3>
            <div class="grid">
                <div>
                    <div class="form-group">
                        <label>Shop ID:</label>
                        <input type="text" id="sale-shop-id" placeholder="Enter shop ID">
                    </div>
                    <div class="form-group">
                        <label>Product ID:</label>
                        <input type="text" id="sale-product-id" placeholder="Enter product ID">
                    </div>
                </div>
                <div>
                    <div class="form-group">
                        <label>Quantity:</label>
                        <input type="number" id="sale-quantity" min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label>Selling Price (optional):</label>
                        <input type="number" id="sale-price" step="0.01" placeholder="Leave empty to use default">
                    </div>
                </div>
            </div>
            <button class="btn btn-success" onclick="recordSale()">Record Sale</button>
            <div id="sale-loading" class="loading">Processing sale...</div>
            <div id="sale-response" class="response-area"></div>
        </div>

        <!-- Record Restock -->
        <div class="api-section">
            <h3 class="section-title">üì¶ Record Restock</h3>
            <div class="grid">
                <div>
                    <div class="form-group">
                        <label>Shop ID:</label>
                        <input type="text" id="restock-shop-id" placeholder="Enter shop ID">
                    </div>
                    <div class="form-group">
                        <label>Product ID:</label>
                        <input type="text" id="restock-product-id" placeholder="Enter product ID">
                    </div>
                </div>
                <div>
                    <div class="form-group">
                        <label>Quantity:</label>
                        <input type="number" id="restock-quantity" min="1" value="10">
                    </div>
                    <div class="form-group">
                        <label>Cost Price:</label>
                        <input type="number" id="restock-cost" step="0.01" placeholder="Cost per unit">
                    </div>
                    <div class="form-group">
                        <label>Selling Price:</label>
                        <input type="number" id="restock-selling" step="0.01" placeholder="Selling price per unit">
                    </div>
                </div>
            </div>
            <button class="btn btn-warning" onclick="recordRestock()">Record Restock</button>
            <div id="restock-loading" class="loading">Processing restock...</div>
            <div id="restock-response" class="response-area"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';

        // Helper function to make API calls
        async function makeApiCall(endpoint, options = {}) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                return await response.json();
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        // Show/hide loading indicators
        function showLoading(elementId, show = true) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.display = show ? 'block' : 'none';
            }
        }

        // Display response in response area
        function displayResponse(elementId, data, isSuccess = true) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = JSON.stringify(data, null, 2);
                element.className = `response-area ${isSuccess ? 'response-success' : 'response-error'}`;
            }
        }

        // Check API health
        async function checkHealth() {
            showLoading('health-loading');
            const data = await makeApiCall('/health');
            showLoading('health-loading', false);
            displayResponse('health-response', data, data.success !== false);
        }

        // Get products
        async function getProducts() {
            showLoading('products-loading');
            
            const category = document.getElementById('product-category').value;
            const search = document.getElementById('product-search').value;
            const commonOnly = document.getElementById('common-only').checked;
            
            let endpoint = '/products';
            const params = new URLSearchParams();
            
            if (category) params.append('category', category);
            if (search) params.append('search', search);
            if (commonOnly) params.append('common', 'true');
            
            if (params.toString()) {
                endpoint += '?' + params.toString();
            }
            
            const data = await makeApiCall(endpoint);
            showLoading('products-loading', false);
            displayResponse('products-response', data, data.success);
            
            // Display products in grid
            if (data.success && data.products) {
                displayProductsGrid(data.products);
            }
        }

        // Display products in grid format
        function displayProductsGrid(products) {
            const grid = document.getElementById('products-grid');
            grid.innerHTML = '';
            
            products.forEach(product => {
                const card = document.createElement('div');
                card.className = `product-card ${product.is_common ? 'common' : ''}`;
                card.innerHTML = `
                    <h4>${product.name}</h4>
                    <p><strong>Brand:</strong> ${product.brand}</p>
                    <p><strong>Category:</strong> ${product.category}</p>
                    <p><strong>Price:</strong> ‚Çπ${product.default_price}</p>
                    <p><strong>Unit:</strong> ${product.unit}</p>
                    <p><strong>ID:</strong> <code>${product.id}</code></p>
                    ${product.is_common ? '<span class="status-indicator status-ok">Common</span>' : ''}
                `;
                grid.appendChild(card);
            });
        }

        // Get shop stats
        async function getShopStats() {
            const shopId = document.getElementById('stats-shop-id').value;
            if (!shopId) {
                alert('Please enter a shop ID');
                return;
            }
            
            showLoading('stats-loading');
            const data = await makeApiCall(`/shops/${shopId}/stats`);
            showLoading('stats-loading', false);
            displayResponse('stats-response', data, data.success);
            
            if (data.success && data.stats) {
                displayStatsCards(data.stats);
            }
        }

        // Display stats cards
        function displayStatsCards(stats) {
            const container = document.getElementById('stats-cards');
            container.innerHTML = `
                <div class="stats-card">
                    <div class="stats-value">${stats.total_products}</div>
                    <div>Total Products</div>
                </div>
                <div class="stats-card">
                    <div class="stats-value">${stats.low_stock_items}</div>
                    <div>Low Stock Items</div>
                </div>
                <div class="stats-card">
                    <div class="stats-value">‚Çπ${stats.today_sales_amount.toFixed(2)}</div>
                    <div>Today's Sales</div>
                </div>
                <div class="stats-card">
                    <div class="stats-value">‚Çπ${stats.inventory_value.toFixed(2)}</div>
                    <div>Inventory Value</div>
                </div>
            `;
        }

        // Get inventory
        async function getInventory() {
            const shopId = document.getElementById('inventory-shop-id').value;
            if (!shopId) {
                alert('Please enter a shop ID');
                return;
            }
            
            showLoading('inventory-loading');
            const data = await makeApiCall(`/inventory/${shopId}`);
            showLoading('inventory-loading', false);
            displayResponse('inventory-response', data, data.success);
            
            if (data.success && data.inventory) {
                displayInventoryGrid(data.inventory);
            }
        }

        // Display inventory grid
        function displayInventoryGrid(inventory) {
            const grid = document.getElementById('inventory-grid');
            grid.innerHTML = '';
            
            inventory.forEach(item => {
                const card = document.createElement('div');
                card.className = `inventory-card ${item.low_stock ? 'low-stock' : ''}`;
                
                let stockStatus = 'status-ok';
                if (item.current_stock === 0) stockStatus = 'status-out';
                else if (item.low_stock) stockStatus = 'status-low';
                
                card.innerHTML = `
                    <h4>${item.product_name}</h4>
                    <p><strong>Brand:</strong> ${item.brand}</p>
                    <p><strong>Current Stock:</strong> ${item.current_stock} ${item.unit}</p>
                    <p><strong>Selling Price:</strong> ‚Çπ${item.selling_price}</p>
                    <p><strong>Reorder Level:</strong> ${item.reorder_level}</p>
                    <span class="status-indicator ${stockStatus}">
                        ${item.current_stock === 0 ? 'Out of Stock' : item.low_stock ? 'Low Stock' : 'In Stock'}
                    </span>
                    <div class="quick-actions">
                        <button class="btn" onclick="quickSale('${item.product_id}')">Quick Sale</button>
                        <button class="btn btn-warning" onclick="quickRestock('${item.product_id}')">Restock</button>
                    </div>
                    <p style="font-size: 12px; color: #666; margin-top: 5px;">ID: ${item.product_id}</p>
                `;
                grid.appendChild(card);
            });
        }

        // Record sale
        async function recordSale() {
            const shopId = document.getElementById('sale-shop-id').value;
            const productId = document.getElementById('sale-product-id').value;
            const quantity = parseInt(document.getElementById('sale-quantity').value);
            const price = parseFloat(document.getElementById('sale-price').value);
            
            if (!shopId || !productId || !quantity) {
                alert('Please fill in all required fields');
                return;
            }
            
            const payload = {
                shop_id: shopId,
                product_id: productId,
                quantity: quantity
            };
            
            if (price && price > 0) {
                payload.selling_price = price;
            }
            
            showLoading('sale-loading');
            const data = await makeApiCall('/inventory/sale', {
                method: 'POST',
                body: JSON.stringify(payload)
            });
            showLoading('sale-loading', false);
            displayResponse('sale-response', data, data.success);
        }

        // Record restock
        async function recordRestock() {
            const shopId = document.getElementById('restock-shop-id').value;
            const productId = document.getElementById('restock-product-id').value;
            const quantity = parseInt(document.getElementById('restock-quantity').value);
            const costPrice = parseFloat(document.getElementById('restock-cost').value);
            const sellingPrice = parseFloat(document.getElementById('restock-selling').value);
            
            if (!shopId || !productId || !quantity) {
                alert('Please fill in all required fields');
                return;
            }
            
            const payload = {
                shop_id: shopId,
                product_id: productId,
                quantity: quantity
            };
            
            if (costPrice && costPrice > 0) {
                payload.cost_price = costPrice;
            }
            
            if (sellingPrice && sellingPrice > 0) {
                payload.selling_price = sellingPrice;
            }
            
            showLoading('restock-loading');
            const data = await makeApiCall('/inventory/restock', {
                method: 'POST',
                body: JSON.stringify(payload)
            });
            showLoading('restock-loading', false);
            displayResponse('restock-response', data, data.success);
        }

        // Quick actions from inventory grid
        function quickSale(productId) {
            document.getElementById('sale-product-id').value = productId;
            document.getElementById('sale-quantity').value = '1';
            document.getElementById('sale-product-id').scrollIntoView();
        }

        function quickRestock(productId) {
            document.getElementById('restock-product-id').value = productId;
            document.getElementById('restock-product-id').scrollIntoView();
        }

        // Initialize on page load
        window.addEventListener('load', function() {
            checkHealth();
            console.log('ShopTracker API Tester loaded');
            console.log('Make sure your Flask backend is running on http://localhost:5000');
        });
    </script>
</body>
</html>